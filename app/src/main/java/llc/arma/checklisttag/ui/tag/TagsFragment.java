package llc.arma.checklisttag.ui.tag;import android.content.Context;import android.os.Bundle;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.Toast;import com.google.android.material.tabs.TabLayout;import com.google.android.material.tabs.TabLayoutMediator;import org.jetbrains.annotations.NotNull;import androidx.annotation.NonNull;import androidx.annotation.Nullable;import androidx.databinding.DataBindingUtil;import androidx.fragment.app.Fragment;import androidx.fragment.app.FragmentResultListener;import androidx.lifecycle.ViewModelProvider;import androidx.navigation.Navigation;import androidx.swiperefreshlayout.widget.SwipeRefreshLayout;import androidx.viewpager2.widget.ViewPager2;import llc.arma.checklisttag.R;import llc.arma.checklisttag.data.Tag;import llc.arma.checklisttag.data.TagDiffUtil;import llc.arma.checklisttag.databinding.TagsFragmentBinding;public class TagsFragment extends Fragment implements FragmentResultListener {    private TagsFragmentBinding binding;    private TagsViewModel viewModel;    private TagPager adapter;    @Override    public void onCreate(@Nullable Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        adapter = new TagPager(getChildFragmentManager(), getLifecycle());    }    @Nullable    @Override    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container,                             @Nullable Bundle savedInstanceState) {        binding = DataBindingUtil.inflate(inflater, R.layout.tags_fragment, container,                false);        binding.setLifecycleOwner(getViewLifecycleOwner());        binding.setModel(viewModel);        return binding.getRoot();    }    @Override    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {        super.onViewCreated(view, savedInstanceState);        binding.getRoot().setOnApplyWindowInsetsListener((v, insets) -> {            binding.getRoot().setPadding(insets.getSystemWindowInsetLeft(),                    insets.getSystemWindowInsetTop(),                    insets.getSystemWindowInsetRight(),                    insets.getSystemWindowInsetBottom());            return insets;        });        binding.tagPager.setOffscreenPageLimit(2);        binding.tagPager.setAdapter(adapter);        binding.tagPager.setOrientation(ViewPager2.ORIENTATION_HORIZONTAL);        new TabLayoutMediator(binding.tabLayout, binding.tagPager, (tab, position) -> {            switch (position){                case 0: tab.setText("NFC"); break;                case 1: tab.setText("BLE"); break;            }        }).attach();        viewModel.getShowLoginEvent().observe(getViewLifecycleOwner(), event -> {            if(event.isHandled()){                Navigation.findNavController(requireActivity(), R.id.mainContainer)                        .navigate(R.id.action_tagsFragment_to_loginFragment2);            }        });        viewModel.getShowWriteEvent().observe(getViewLifecycleOwner(), event -> {            if(event.isHandled()){                Navigation.findNavController(requireActivity(), R.id.mainContainer)                        .navigate(R.id.action_tagsFragment_to_writeFragment);            }        });        viewModel.getLoadResult().observe(getViewLifecycleOwner(), aBoolean -> {            if(aBoolean){                Toast.makeText(requireContext(), "Success", Toast.LENGTH_SHORT).show();            }        });        requireActivity().getSupportFragmentManager()                .setFragmentResultListener("bleSelectResult", getViewLifecycleOwner(), this);        requireActivity().getSupportFragmentManager()                .setFragmentResultListener("nfcScan", getViewLifecycleOwner(), this);    }    @Override    public void onAttach(@NonNull Context context) {        super.onAttach(context);        viewModel = new ViewModelProvider(requireActivity()).get(TagsViewModel.class);    }    @Override    public void onFragmentResult(@NonNull String requestKey, @NonNull Bundle result) {        switch (requestKey){            case "bleSelectResult":                viewModel.onTagScanned(result.getString("sid"), result.getString("bleSelectResult"));                break;            case "nfcScan":                viewModel.onTagScanned(result.getString("sid"), result.getString("nfcId"));                break;        }    }}